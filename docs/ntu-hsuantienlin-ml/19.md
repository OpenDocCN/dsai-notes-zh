# 1 -- Linear Support Vector Machine


关于台湾大学林轩田老师的《机器学习基石》课程，我们已经总结了16节课的笔记。这里附上基石第一节课的博客地址：

[台湾大学林轩田机器学习基石课程学习笔记1 – The Learning Problem](http://blog.csdn.net/red_stone1/article/details/72899485)

本系列同样分成16节课，将会介绍《机器学习基石》的进阶版《机器学习技法》，更深入地探讨机器学习一些高级算法和技巧。

### **Large-Margin Separating Hyperplane**

回顾一下我们之前介绍了linear classification，对于线性可分的情况，我们可以使用PLA/pocket算法在平面或者超平面上把正负类分开。

![这里写图片描述](img/36ee67ed919b5006df931c449a3ed907.jpg)

例如对平面2D这种情况，我们可以找到一条直线，能将正类和负类完全分开。但是，这样的直线通常不止一条，如下图所示。那么，下图中的三条分类线都能将数据分开，但是哪条线更好呢？

![这里写图片描述](img/5e87b4f4010932f8ee9459df5d4e6d40.jpg)

这三条直线都是由PLA/pocket算法不断修正错误点而最终产生的，整个确定直线形状的过程是随机的。单从分类效果上看，这三条直线都满足要求，而且都满足VC bound要求，模型复杂度![](img/d7dadd85f490ced3e3f3d2a8f070087a.jpg)是一样的，即具有一定的泛化能力。但是，如果要选择的话，凭第一感觉，我们还是会选择第三条直线，感觉它的分类效果更好一些。那这又是为什么呢？

先给个简单解释，一般情况下，训练样本外的测量数据应该分布在训练样本附近，但与训练样本的位置有一些偏差。若要保证对未知的测量数据也能进行正确分类，最好让分类直线距离正类负类的点都有一定的距离。这样能让每个样本点附近的圆形区域是“安全”的。圆形区域越大，表示分类直线对测量数据误差的容忍性越高，越“安全”。

![这里写图片描述](img/7f3f247dbdd7bb038deb82cc118ab484.jpg)

如上图所示，左边的点距离分类直线的最小距离很小，它的圆形区域很小。那么，这种情况下，分类线对测量数据误差的容忍性就很差，测量数据与样本数据稍有偏差，很有可能就被误分。而右边的点距离分类直线的最小距离更大一些，其圆形区域也比较大。这种情况下，分类线对测量数据误差的容忍性就相对来说大很多，不容易误分。也就是说，左边分类线和右边分类线的最大区别是对这类测量误差的容忍度不同。

那么，如果每一笔训练资料距离分类线越远的话，就表示分类型可以忍受更多的测量误差（noise）。我们之前在《机器学习基石》中介绍过，noise是造成overfitting的主要原因，而测量误差也是一种noise。所以，如果分类线对测量误差的容忍性越好的话，表示这是一条不错的分类线。那么，我们的目标就是找到这样一条最“健壮”的线，即距离数据点越远越好。

![这里写图片描述](img/81f068986d60a0891c60a5684bc0e441.jpg)

上面我们用圆形区域表示分类线能够容忍多少误差，也就相当于计算点到直线的距离。距离越大，表示直线越“胖”，越能容忍误差；距离越小，表示直线越“瘦”，越不能容忍误差。越胖越好（像杨贵妃那样的哦~）。

![这里写图片描述](img/756a78600c582886c2696fe1d61e2e21.jpg)

如何定义分类线有多胖，就是看距离分类线最近的点与分类线的距离，我们把它用margin表示。分类线由权重w决定，目的就是找到使margin最大时对应的w值。整体来说，我们的目标就是找到这样的分类线并满足下列条件：

*   **分类正确，即![](img/8bcacd1d466fb3be231d49e874891f02.jpg)**

*   **margin最大化**

![这里写图片描述](img/97cf99f084f31ae6876488b0aa97b18a.jpg)

### **Standard Large-Margin Problem**

要让margin最大，即让离分类线最近的点到分类线距离最大，我们先来看一下如何计算点到分类线的距离。

首先，我们将权重![](img/ecd821b27e091c590a46f60976ecb92e.jpg)中的![](img/ba3c75638c442d45dd1986e37b37fd7e.jpg)拿出来，用b表示。同时省去![](img/ddfc662b32da3468fabb177c80db8ea6.jpg)项。这样，hypothesis就变成了![](img/757f9582d67ce5194f85e5d47564767b.jpg)。

![这里写图片描述](img/f6e8f20e9b21ce90804daa75eb9fff0d.jpg)

下面，利用图解的方式，详细推导如何计算点到分类平面的距离：

![这里写图片描述](img/a7c02de7f2855e6e5fc3bcebc340dc32.jpg)

如上图所示，平面上有两个点：x’和x”。因为这两个点都在分类平面上，所以它们都满足：

![](img/d4dba4f3e5f82c0d9f88cf29abf8e046.jpg)

![](img/50560407af48d279c351803f52ffdf17.jpg)

同时可以得到：![](img/52fc30fa9b30c208e811c22e6fbf5476.jpg)，![](img/4010057f1d98618512057e7ae7f875fc.jpg)，则有：

![](img/501dfaadd1ff06fbc588d54b52bfe378.jpg)

(x”-x’)是平面上的任一向量，(x”-x’)与w内积为0，表示(x”-x’)垂直于w，那么w就是平面的法向量。

现在，若要计算平面外一点x到该平面的距离，做法是只要将向量(x-x’)投影到垂直于该平面的方向（即w方向）上就可以了。那么，令(x”-x’)与w的夹角为![](img/51b8359f970d2bfe2ad4cdc3ac1aed3c.jpg)，距离就可以表示为：

![](img/38f9328e1e02a0acfe2db4fb3294d65c.jpg)

代入![](img/52fc30fa9b30c208e811c22e6fbf5476.jpg)，可得：

![](img/45d70e1c9c69cde10e49d5668d9284eb.jpg)

点到分类面（Separating Hyperplane）的距离已经算出来了。基于这个分类面，所有的点均满足：![](img/309436010528a3f04e65b8de4ad3998a.jpg)，表示所有点都分类正确，则distance公式就可以变换成：

![](img/873de15b0e040c5826564a1f81c6d2c3.jpg)

那么，我们的目标形式就转换为：

![这里写图片描述](img/d5acd213fda5fab334d9375550179136.jpg)

对上面的式子还不容易求解，我们继续对它进行简化。我们知道分类面![](img/19b91ac27388102ab4db13efc06dff1c.jpg)和![](img/6196770af06ce0b98f705ecadc9920af.jpg)其实是一样的。也就是说，对w和b进行同样的缩放还会得到同一分类面。所以，为了简化计算，我们令距离分类满最近的点满足![](img/273899ae7b2132d1efb36818f09ae9d5.jpg)。那我们所要求的margin就变成了:

![](img/9c1892438e837f773e5d70e76f350984.jpg)

这样，目标形式就简化为：

![这里写图片描述](img/eb9140488401f5c58357cebc549c06cb.jpg)

这里可以省略条件：![](img/309436010528a3f04e65b8de4ad3998a.jpg)，因为满足条件![](img/273899ae7b2132d1efb36818f09ae9d5.jpg)必然满足大于零的条件。我们的目标就是根据这个条件，计算![](img/3bc453c7df64b7414112b903975936ce.jpg)的最大值。

刚刚我们讲的距离分类满最近的点满足![](img/273899ae7b2132d1efb36818f09ae9d5.jpg)，也就是说对所有的点满足![](img/9cae1107e06e79ea45c46840638c56f7.jpg)。另外，因为最小化问题我们最熟悉也最好解，所以可以把目标![](img/3bc453c7df64b7414112b903975936ce.jpg)最大化转化为计算![](img/fe7bbafafbb55291e5ff44c29986ee21.jpg)的最小化问题。

![这里写图片描述](img/4e24769dbecf76910c33b02407875d7a.jpg)

如上图所示，最终的条件就是![](img/9cae1107e06e79ea45c46840638c56f7.jpg)，而我们的目标就是最小化![](img/fe7bbafafbb55291e5ff44c29986ee21.jpg)值。

### **Support Vector Machine**

现在，条件和目标变成：

![这里写图片描述](img/789687d676ee27ba75162f6004735c9e.jpg)

现在，举个例子，假如平面上有四个点，两个正类，两个负类：

![这里写图片描述](img/fefa3a35bb107bc9225edf90334d4035.jpg)

不同点的坐标加上条件![](img/9cae1107e06e79ea45c46840638c56f7.jpg)，可以得到：

![这里写图片描述](img/5ab8fd522520256ed4b0c733bc1f8b5e.jpg)

最终，我们得到的条件是：

![](img/fa3478d6e7f7bc744f3cac90a9170795.jpg)

![](img/a474b81288355808bdfb7c5f9cc03770.jpg)

而我们的目标是：

![](img/56d75dfecd49f6af25c0dfdad931887b.jpg)

目标最小值为1，即![](img/3cd77a5d26a3d307aa1d57b0df6a5e16.jpg)，那么这个例子就得到了最佳分类面的解，如图所示，且![](img/8aa8c56bfb9129b2f5b68a02c3cef325.jpg)。分类面的表达式为：

![](img/f6a7dd94fa7611956751e0382879a043.jpg)

最终我们得到的矩的表达式为：

![](img/5d26975224056e1a526d82122204317d.jpg)

Support Vector Machine(SVM)这个名字从何而来？为什么把这种分类面解法称为支持向量机呢？这是因为分类面仅仅由分类面的两边距离它最近的几个点决定的，其它点对分类面没有影响。决定分类面的几个点称之为支持向量（Support Vector），好比这些点“支撑”着分类面。而利用Support Vector得到最佳分类面的方法，称之为支持向量机（Support Vector Machine）。

下面介绍SVM的一般求解方法。先写下我们的条件和目标：

![这里写图片描述](img/ea638acb7c3e795803cb44e9be1df579.jpg)

这是一个典型的二次规划问题，即Quadratic Programming（QP）。因为SVM的目标是关于w的二次函数，条件是关于w和b的一次函数，所以，它的求解过程还是比较容易的，可以使用一些软件（例如Matlab）自带的二次规划的库函数来求解。下图给出SVM与标准二次规划问题的参数对应关系：

![这里写图片描述](img/590aee7b7c40d13e2c5b3627202ca163.jpg)

那么，线性SVM算法可以总结为三步：

*   **计算对应的二次规划参数Q，p，A，c**

*   **根据二次规划库函数，计算b，w**

*   **将b和w代入![](img/f7480a086f97ad3ec2aa19c5c1102c50.jpg)，得到最佳分类面**

![这里写图片描述](img/80758fbb27b9cc2cf03b287f228f7854.jpg)

这种方法称为Linear Hard-Margin SVM Algorithm。如果是非线性的，例如包含x的高阶项，那么可以使用我们之前在《机器学习基石》课程中介绍的特征转换的方法，先作![](img/d3c7fd7b2a38ace00ee14265a1527997.jpg)的特征变换，从非线性的x域映射到线性的z域空间，再利用Linear Hard-Margin SVM Algorithm求解即可。

### **Reasons behind Large-Margin Hyperplane**

从视觉和直觉的角度，我们认为Large-Margin Hyperplane的分类效果更好。SVM的这种思想其实与我们之前介绍的机器学习非常重要的正则化regularization思想很类似。regularization的目标是将![](img/a8b61417c614fe3bc2af079fa6ed96cd.jpg)最小化，条件是![](img/b6d200f980aaa3ee660d804911e853cc.jpg)；SVM的目标是![](img/67f16bf9eedca78b8c35cf58f249f43e.jpg)最小化，条件是![](img/2a35ee6d5e962de03eca129426833bec.jpg)，即保证了![](img/8979e87b0fb1d13fdfaad13dcfe4638b.jpg)。有趣的是，regularization与SVM的目标和限制条件分别对调了。其实，考虑的内容是类似的，效果也是相近的。SVM也可以说是一种weight-decay regularization，限制条件是![](img/8979e87b0fb1d13fdfaad13dcfe4638b.jpg)。

![这里写图片描述](img/b049167335e751ffdff8e9d6f92422f1.jpg)

从另一方面来看，Large-Margin会限制Dichotomies的个数。这从视觉上也很好理解，假如一条分类面越“胖”，即对应Large-Margin，那么它可能shtter的点的个数就可能越少：

![这里写图片描述](img/05a58783f6d6d6659782736e6dde09b6.jpg)

之前的《机器学习基石》课程中介绍过，Dichotomies与VC Dimension是紧密联系的。也就是说如果Dichotomies越少，那么复杂度就越低，即有效的VC Dimension就越小，得到![](img/576638187193b3b48c902b404e059c9d.jpg)，泛化能力强。

下面我们从概念的角度推导一下为什么dichotomies越少，VC Dimension就越少。首先我们考虑一下Large-Margin演算法的VC Dimension，记为![](img/4021ef185aeb8db23f74722c66146670.jpg)。![](img/4021ef185aeb8db23f74722c66146670.jpg)与数据有关，而我们之前介绍的![](img/63926b21692667f723efd5f25797c88c.jpg)与数据无关。

假如平面上有3个点分布在单位圆上，如果Margin为0，即![](img/034d56aa2a75a8950d53689324807ee0.jpg)，这条细细的直线可以很容易将圆上任意三点分开（shatter），就能得到它的![](img/469b1ecc529270c36127c531e37a22cd.jpg)。如果![](img/d1dc93bafa5b5049f85ea6f2eef73148.jpg)，这条粗粗的线无论如何都不能将圆上的任一三点全完分开（no shatter），因为圆上必然至少存在两个点的距离小于![](img/6e2311b6f3563ded95d2ca9d04ebcafd.jpg)，那么其对应d的![](img/72ec03d3c2218812a91b20201f968b28.jpg)。

![这里写图片描述](img/29f63a519a15372fa6d5cf7fd2276497.jpg)

那么，一般地，在d维空间，当数据点分布在半径为R的超球体内时，得到的![](img/4021ef185aeb8db23f74722c66146670.jpg)满足下列不等式：

![这里写图片描述](img/ccaccb87f2f75169f850df9047c18028.jpg)

之前介绍的Perceptrons的VC Dimension为d+1，这里得到的结果是Large-Margin演算法的![](img/640aa38ed9ea2dfa2861b2c082a9a4d3.jpg)。所以，由于Large-Margin，得到的dichotomies个数减少，从而VC Dimension也减少了。VC Dimension减少降低了模型复杂度，提高了泛化能力。

### **总结**

本节课主要介绍了线性支持向量机（Linear Support Vector Machine）。我们先从视觉角度出发，希望得到一个比较“胖”的分类面，即满足所有的点距离分类面都尽可能远。然后，我们通过一步步推导和简化，最终把这个问题转换为标准的二次规划（QP）问题。二次规划问题可以使用Matlab等软件来进行求解，得到我们要求的w和b，确定分类面。这种方法背后的原理其实就是减少了dichotomies的种类，减少了有效的VC Dimension数量，从而让机器学习的模型具有更好的泛化能力。

**_注明：_**

文章中所有的图片均来自台湾大学林轩田《机器学习技法》课程
